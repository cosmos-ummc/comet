# Backend Deployment

## protobuf notes for new endpoints

1. Add comments for all payloads and attributes

2. Call `.\scripts\protoc-gen.cmd` to generate golang .pb.go files

3. Manually copy and paste newly generated `cosmos-service.swagger.json` object to `specs.swagger.json`, follow exactly the existing standards.

4. Call `.\scripts\protoc-gen.cmd` again to generate API specs.

5. Verify if API specs are correctly generated by opening `index.html` in `.\api\swagger\public` folder

## Initialize Firewall

ssh root@[server ip]

ufw allow OpenSSH

ufw enable

exit

## Create User
ssh root@[server ip]

adduser [user]

usermod -aG sudo [user]

rsync --archive --chown=[user]:[user] ~/.ssh /home/[user]

exit

## Install Golang Dependencies

cd ~

curl -O https://dl.google.com/go/go1.13.9.linux-amd64.tar.gz

sudo tar -xvf go1.13.9.linux-amd64.tar.gz -C /usr/local

mkdir -p $HOME/go/{bin,src}

nano ~/.profile

export GOPATH=$HOME/go

export PATH=$PATH:$GOPATH/bin

export PATH=$PATH:$GOPATH/bin:/usr/local/go/bin

. ~/.profile

## Pull Backend Project

cd $GOPATH/src

env GIT_TERMINAL_PROMPT=1 go get github.com/cosmos-ummc/comet

## Build Backend Project

cd github.com/cosmos-ummc/comet

go build cmd/server/main.go

## Initialize Service

sudo nano /lib/systemd/system/cosmosbe.service

paste contents from service.txt

## Start Service

sudo service cosmosbe start

## Restart Service

sudo service cosmosbe restart

## Expose Port in Firewall

sudo ufw allow 10001/tcp

sudo ufw allow 10002/tcp

## View Service

sudo lsof -i -P -n | grep LISTEN

## .Profile Shortcut

navbe() {

        cd $HOME/go/src/github.com/cosmos-ummc/comet

}

deploybe() {

        cd $HOME/go/src/github.com/cosmos-ummc/comet

        go build cmd/server/main.go

        cd ~

        sudo service cosmosbe restart

}